<!-- Add this section to your product_detail.html template -->

<!-- Enhanced Product Details with GST -->
<div class="product-details">
    <div class="detail-grid">
        {% if product.category %}
        <div class="detail-item">
            <div class="detail-label">Category</div>
            <div class="detail-value">{{ product.category }}</div>
        </div>
        {% endif %}

        <div class="detail-item">
            <div class="detail-label">Base Price</div>
            <div class="detail-value price-value">‚Çπ{{ product.price }}</div>
        </div>

        <div class="detail-item">
            <div class="detail-label">GST Rate</div>
            <div class="detail-value">{{ product.gst }}%</div>
        </div>

        {% if product.hsn_code %}
        <div class="detail-item">
            <div class="detail-label">HSN Code</div>
            <div class="detail-value">{{ product.hsn_code }}</div>
        </div>
        {% endif %}

        <div class="detail-item">
            <div class="detail-label">Store Owner</div>
            <div class="detail-value">{{ store_owner.username }}</div>
        </div>
    </div>

    <!-- GST Calculation Display -->
    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 1rem; margin-top: 1rem;">
        <h4 style="color: #856404; margin-bottom: 0.5rem;">üí∞ Price Breakdown:</h4>
        <div style="display: grid; grid-template-columns: 1fr auto; gap: 0.5rem; font-family: monospace;">
            <span>Base Price:</span>
            <span>‚Çπ{{ product.price }}</span>
            <span>GST ({{ product.gst }}%):</span>
            <span id="gst-amount">‚Çπ0.00</span>
            <hr style="grid-column: 1 / -1; margin: 0.5rem 0; border: 1px solid #ffc107;">
            <strong>Total Price:</strong>
            <strong id="total-price">‚Çπ{{ product.price }}</strong>
        </div>
    </div>
</div>

<!-- Enhanced Quantity Selector with Real-time GST Calculation -->
{% if product.quantity > 0 %}
<div class="quantity-selector">
    <h3>Select Quantity</h3>
    <form method="post" action="{% url 'add_to_cart' username=store_owner.username product_id=product.id %}" class="add-to-cart-form">
        {% csrf_token %}
        <div class="quantity-controls">
            <button type="button" class="quantity-btn" onclick="decreaseQuantity()">‚àí</button>
            <input type="number" name="quantity" id="quantity" value="1" min="1" max="{{ product.quantity }}" class="quantity-input" onchange="updatePricing()">
            <button type="button" class="quantity-btn" onclick="increaseQuantity()">+</button>
        </div>
        <small style="color: #666;">Maximum {{ product.quantity }} items available</small>

        <!-- Real-time Total Display -->
        <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
            <h4 style="color: #1976d2; margin-bottom: 0.5rem;">üßÆ Order Total:</h4>
            <div style="display: grid; grid-template-columns: 1fr auto; gap: 0.5rem; font-family: monospace;">
                <span>Quantity:</span>
                <span id="display-quantity">1</span>
                <span>Subtotal:</span>
                <span id="display-subtotal">‚Çπ{{ product.price }}</span>
                <span>GST ({{ product.gst }}%):</span>
                <span id="display-gst">‚Çπ0.00</span>
                <hr style="grid-column: 1 / -1; margin: 0.5rem 0; border: 1px solid #2196f3;">
                <strong>Final Total:</strong>
                <strong id="display-total">‚Çπ{{ product.price }}</strong>
            </div>
        </div>

        <div class="actions">
            <button type="submit" class="btn btn-success">
                üõí Add to Cart
            </button>
            <a href="{% url 'cart_view' username=store_owner.username %}" class="btn btn-primary">
                üëÅÔ∏è View Cart
            </a>
        </div>
    </form>
</div>
{% endif %}

<script>
    // Debug: Log the template values
    console.log('Template Debug:');
    console.log('product.price:', '{{ product.price }}');
    console.log('product.gst:', '{{ product.gst }}');
    console.log('product.quantity:', '{{ product.quantity }}');

    // Convert template values to JavaScript with proper error handling
    const basePrice = parseFloat('{{ product.price }}') || 0;
    const gstRate = parseFloat('{{ product.gst }}') / 100 || 0;
    const maxQuantity = parseInt('{{ product.quantity }}') || 1;

    // Debug: Log the converted values
    console.log('JavaScript Values:');
    console.log('basePrice:', basePrice);
    console.log('gstRate:', gstRate);
    console.log('maxQuantity:', maxQuantity);

    function updatePricing() {
        console.log('updatePricing called');

        const quantityInput = document.getElementById('quantity');
        const quantity = parseInt(quantityInput.value) || 1;

        console.log('Current quantity:', quantity);

        // Calculate prices
        const subtotal = basePrice * quantity;
        const gstAmount = subtotal * gstRate;
        const totalPrice = subtotal + gstAmount;

        console.log('Calculations:');
        console.log('subtotal:', subtotal);
        console.log('gstAmount:', gstAmount);
        console.log('totalPrice:', totalPrice);

        // Update single unit display
        const singleGst = basePrice * gstRate;
        const singleTotal = basePrice + singleGst;

        const gstAmountEl = document.getElementById('gst-amount');
        const totalPriceEl = document.getElementById('total-price');

        if (gstAmountEl) gstAmountEl.textContent = '‚Çπ' + singleGst.toFixed(2);
        if (totalPriceEl) totalPriceEl.textContent = '‚Çπ' + singleTotal.toFixed(2);

        // Update order total display
        const displayElements = {
            quantity: document.getElementById('display-quantity'),
            subtotal: document.getElementById('display-subtotal'),
            gst: document.getElementById('display-gst'),
            total: document.getElementById('display-total')
        };

        if (displayElements.quantity) displayElements.quantity.textContent = quantity;
        if (displayElements.subtotal) displayElements.subtotal.textContent = '‚Çπ' + subtotal.toFixed(2);
        if (displayElements.gst) displayElements.gst.textContent = '‚Çπ' + gstAmount.toFixed(2);
        if (displayElements.total) displayElements.total.textContent = '‚Çπ' + totalPrice.toFixed(2);

        console.log('Updated all display elements');
    }

    function decreaseQuantity() {
        console.log('decreaseQuantity called');
        const quantityInput = document.getElementById('quantity');
        const currentValue = parseInt(quantityInput.value);
        console.log('Current value:', currentValue);

        if (currentValue > 1) {
            quantityInput.value = currentValue - 1;
            console.log('New value:', quantityInput.value);
            updatePricing();
        } else {
            console.log('Cannot decrease below 1');
        }
    }

    function increaseQuantity() {
        console.log('increaseQuantity called');
        const quantityInput = document.getElementById('quantity');
        const currentValue = parseInt(quantityInput.value);
        console.log('Current value:', currentValue, 'Max:', maxQuantity);

        if (currentValue < maxQuantity) {
            quantityInput.value = currentValue + 1;
            console.log('New value:', quantityInput.value);
            updatePricing();
        } else {
            console.log('Cannot increase above', maxQuantity);
        }
    }

    // Initialize pricing on page load
    document.addEventListener('DOMContentLoaded', function() {
        updatePricing();
    });
</script>

<style>
    .product-details {
        margin-bottom: 2rem;
    }
    
    .detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .detail-item {
        background: #f8f9fa;
        padding: 0.75rem;
        border-radius: 6px;
        border-left: 3px solid #007bff;
    }
    
    .detail-label {
        font-weight: 600;
        color: #495057;
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
    }
    
    .detail-value {
        color: #212529;
        font-size: 1rem;
    }
    
    .price-value {
        font-weight: 700;
        color: #28a745;
        font-size: 1.1rem;
    }
    
    .quantity-selector {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 1.5rem;
        margin-top: 1rem;
    }
    
    .quantity-controls {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 1rem 0;
    }
    
    .quantity-btn {
        background: #007bff;
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 6px;
        font-size: 1.2rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s;
    }
    
    .quantity-btn:hover {
        background: #0056b3;
    }
    
    .quantity-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
    }
    
    .quantity-input {
        width: 80px;
        height: 40px;
        text-align: center;
        border: 2px solid #dee2e6;
        border-radius: 6px;
        font-size: 1rem;
        font-weight: 600;
    }
    
    .quantity-input:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
    
    .actions {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .btn-success {
        background: #28a745;
        color: white;
    }
    
    .btn-success:hover {
        background: #218838;
    }
    
    .btn-primary {
        background: #007bff;
        color: white;
    }
    
    .btn-primary:hover {
        background: #0056b3;
        text-decoration: none;
        color: white;
    }
</style>